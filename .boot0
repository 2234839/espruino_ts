"use strict";var p=0;function d(t){let e=Date.now();p<e&&(p=e),p+=t}var _=0;setInterval(()=>{p>Date.now()||(digitalWrite(NodeMCU.D4,!_),digitalWrite(NodeMCU.D7,1))},100);var n="connected",m="connect";var s="count",h="wifi";var g=require("Storage"),c=g.readJSON(s);g.writeJSON(s,(c||0)+1);var l=g.readJSON(h);var x=require("http"),S=require("ESP8266"),w=x.createServer((t,e)=>{d(300),t.url==="/"?f(e,200,`<h1>Welcome to my simple website!</h1><a href="/about">about</a> | <a href="/reboot">reboot</a> | reboot count ${c}`):t.url==="/about"?f(e,200,"<h1>admin@shenzilong.cn</h1>"):t.url==="/reboot"?S.reboot():f(e,404,"<h1>404 Not Found</h1>")});function f(t,e,i){t.writeHead(e,{"Content-Type":"text/html"}),t.write(i),t.end()}var r=console.log;var o=require("Wifi"),D=require("http"),u=require("ESP8266");r(`boot ${s}:${c}`);var b=t=>{r(n,t.ip,new Date().toISOString()),w.listen(3e3,"0.0.0.0"),D.get("http://worldtimeapi.org/api/timezone/Asia/Shanghai",e=>{let i="";e.on("data",a=>i+=a),e.on("end",()=>r("Beijing time",JSON.parse(i).datetime))})};o.getDetails(t=>{let e=t.status;e.startsWith(m)||o.connect(l.ssid,{password:l.pwd},i=>r(m)),e===n?o.getIP((i,a)=>b(a)):o.on(n,b)});o.stopAP(()=>{});setInterval(()=>{o.getDetails(t=>{t.status!==n&&(r(`not wifi ${n} reboot`),u.reboot())})},30*1e3);o.ping("","");u.ping("","");console.log(u.getResetInfo());
